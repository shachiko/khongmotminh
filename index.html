<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Không Một Mình – Cùng nhau an toàn trực tuyến</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        .quiz-option:hover {
            background-color: #DBEAFE; /* Light blue on hover */
        }
        .quiz-option.selected {
            background-color: #93C5FD; /* Darker blue when selected */
            border-color: #2563EB;
        }
        .quiz-option.correct {
            background-color: #D1FAE5;
            border-color: #059669;
            color: #047857;
            font-weight: bold;
        }
        .quiz-option.incorrect {
            background-color: #FEE2E2;
            border-color: #E11D48;
            color: #BE123C;
        }
        #quiz-container.submitted .quiz-option {
            pointer-events: none;
            cursor: default;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-800 flex flex-col min-h-screen">

    <div id="app" class="container mx-auto p-4 max-w-4xl flex flex-col flex-grow">

        <!-- Header --><header class="text-center my-8">
            <img id="logo" src="logo-tron.png" alt="Logo Không Một Mình" class="w-20 h-20 mx-auto mb-4 rounded-full"
                 onerror="this.onerror=null;this.src='https://placehold.co/100x100/FFFFFF/00529D?text=Logo';">
            <h1 class="text-4xl font-bold text-blue-800">Không Một Mình</h1>
            <p class="text-lg text-blue-600">Cùng nhau an toàn trực tuyến</p>
        </header>

        <main id="main-content" class="flex-grow flex items-center justify-center">
            <!-- Registration View --><div id="registration-view" class="bg-white p-8 rounded-xl shadow-lg text-center w-full">
                 <img id="banner" src="Kmm-01.jpg" alt="Banner Chiến dịch" class="w-full h-64 object-cover rounded-lg mb-6"
                       onerror="this.onerror=null;this.src='https://placehold.co/800x400/00529D/FFFFFF?text=Banner';">
                <h2 class="text-2xl font-bold mb-4">Tham gia Thử thách Bảo vệ</h2>
                <p class="mb-6">Hãy điền thông tin để bắt đầu bài kiểm tra hàng tuần và tích luỹ cúp nhé!</p>
                <form id="registration-form" class="space-y-4 max-w-sm mx-auto">
                    <input type="text" id="student-name" placeholder="Họ và tên của bạn" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <input type="email" id="student-email" placeholder="Email nhận chứng nhận" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <input type="text" id="student-class" placeholder="Lớp" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">BẮT ĐẦU TUẦN 1</button>
                </form>
            </div>

            <!-- Theory View --><div id="theory-view" class="hidden bg-white p-8 rounded-xl shadow-lg w-full">
                <h2 id="theory-title" class="text-2xl font-bold mb-4 text-center">Kiến thức Tuần 1</h2>
                <div id="theory-content" class="text-left mb-6 space-y-4 max-h-[60vh] overflow-y-auto pr-4">
                    <!-- Theory content will be dynamically inserted here -->
                </div>
                <button id="start-quiz-btn" class="mt-6 w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors">Đã hiểu, Bắt đầu làm bài</button>
            </div>

            <!-- Quiz View --><div id="quiz-view" class="hidden bg-white p-8 rounded-xl shadow-lg w-full">
                <h2 id="quiz-title" class="text-2xl font-bold mb-2 text-center">Bài kiểm tra Tuần 1</h2>
                <p id="quiz-description" class="text-center mb-6">Chọn câu trả lời đúng nhất.</p>
                <div id="quiz-container" class="space-y-6"></div>
                <button id="submit-quiz" class="mt-8 w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400">Nộp bài</button>
            </div>
        </main>
    </div>

    <!-- Footer --><footer class="text-center py-6 text-sm text-gray-500">
        <p>&copy; 2025 - Sản phẩm thuộc bản quyền của trường UK ACADEMY HA LONG</p>
    </footer>

    <!-- Result Modal --><div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-md w-full relative transform transition-all scale-95 opacity-0" id="result-content">
            <!-- Normal Result Content --><div id="normal-result-content">
                <h2 id="result-title" class="text-3xl font-bold text-yellow-500 mb-4"></h2>
                <div id="cup-container" class="my-4">
                    <svg class="w-32 h-32 mx-auto text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15h14a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM8 16a2 2 0 114 0H8z"></path><path fill-rule="evenodd" d="M10 0a1 1 0 011 1v.065a8.002 8.002 0 015.657 5.657A1 1 0 0117 8v3.586l1.707 1.707a1 1 0 01-1.414 1.414L16 13.414V8a6.002 6.002 0 00-5-5.917V1a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </div>
                <p id="result-message" class="text-xl font-semibold text-gray-700 my-4"></p>
                <p id="result-score" class="text-lg mb-6"></p>
                <button id="continue-btn-fail" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors mt-4">Tiếp tục làm lại</button>
            </div>

            <!-- Robot Message Content (Initially hidden) --><div id="robot-message-content" class="hidden">
                <img src="robot-uka.png" alt="Robot UKA Hạ Long" class="w-40 h-40 mx-auto mb-4 object-contain"
                     onerror="this.onerror=null;this.src='https://placehold.co/150x150/FFFFFF/00529D?text=Robot';">
                <p id="robot-congrats-text" class="text-xl font-bold text-blue-700 mb-4"></p>
                <div class="flex justify-center space-x-4 mb-4">
                    <button id="share-fb-2" class="bg-blue-800 text-white font-bold py-2 px-5 rounded-lg">Chia sẻ Facebook</button>
                    <button id="share-zalo-2" class="bg-blue-500 text-white font-bold py-2 px-5 rounded-lg">Chia sẻ Zalo</button>
                </div>
                <button id="continue-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors mt-4">Tiếp tục</button>
            </div>
            
            <button id="close-modal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
        </div>
    </div>
    
    <canvas id="fireworks-canvas" class="fixed top-0 left-0 w-full h-full pointer-events-none z-50"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
        // DOM Elements
        const registrationView = document.getElementById('registration-view');
        const theoryView = document.getElementById('theory-view');
        const quizView = document.getElementById('quiz-view');
        const resultModal = document.getElementById('result-modal');
        const resultContent = document.getElementById('result-content');
        const normalResultContent = document.getElementById('normal-result-content');
        const robotMessageContent = document.getElementById('robot-message-content');
        const registrationForm = document.getElementById('registration-form');
        const quizContainer = document.getElementById('quiz-container');
        const submitQuizBtn = document.getElementById('submit-quiz');
        const closeModalBtn = document.getElementById('close-modal');
        const continueBtn = document.getElementById('continue-btn');
        const continueBtnFail = document.getElementById('continue-btn-fail');
        const fireworksCanvas = document.getElementById('fireworks-canvas');
        const theoryContent = document.getElementById('theory-content');
        const theoryTitle = document.getElementById('theory-title');
        const startQuizBtn = document.getElementById('start-quiz-btn');

        // State
        let studentInfo = { name: '', email: '', class: '' };
        let currentQuiz = {};
        let userAnswers = [];
        
        // --- QUIZ DATA ---
        const quizzes = {
            week1: {
                title: "CHỦ ĐỀ 1: BẢO VỆ CÁ NHÂN",
                description: "Nhận biết các tình huống nguy hiểm trên mạng.",
                theory: `
                    <h4 class="text-xl font-bold mb-3 text-blue-700">Các em hãy đọc câu chuyện dưới đây</h4>
                    <p class="mb-4 bg-blue-100 p-3 rounded-lg">Một buổi chiều, Lan đăng lên mạng tấm ảnh thẻ học sinh mới chụp. Ảnh có tên, trường và mã số học sinh. Vài phút sau, một người lạ nhắn tin: “Chào em, chị là nhân viên học bổng. Em gửi thêm số CCCD để nhận quà nhé!”. Lan vui vẻ làm theo. Chỉ một ngày sau, tài khoản của Lan bị chiếm. Hàng chục bạn bè nhận tin nhắn vay tiền từ “Lan giả”.</p>
                    <p class="font-bold">💭 Theo em, Lan đã mắc sai lầm ở đâu?</p>
                    <h4 class="text-xl font-bold mt-6 mb-3 text-blue-700">1. Vì sao cần bảo vệ bản thân trên mạng?</h4>
                    <p>Mạng Internet giống như một ngôi nhà rộng lớn, nơi ai cũng có thể ghé thăm. Nếu ngoài đời em không đưa chìa khóa nhà cho người lạ, thì trên mạng, việc chia sẻ thông tin cá nhân mà không cẩn trọng cũng nguy hiểm y như vậy. Kẻ xấu có thể dùng thông tin đó để lừa đảo, đe dọa hoặc giả mạo em. Giữ bí mật thông tin chính là giữ an toàn cho chính mình.</p>
                    <p class="italic text-blue-600">🌱 Trên mạng, mỗi thông tin nhỏ đều có thể trở thành “dấu vết số”.</p>
                    <h4 class="text-xl font-bold mt-6 mb-3 text-blue-700">2. Thông tin cá nhân là gì?</h4>
                    <p>🧩 Thông tin cá nhân là những dữ liệu giúp người khác nhận biết hoặc xác định em là ai. Chúng có thể là:</p>
                    <ul class="list-disc list-inside space-y-1 pl-4">
                        <li>Họ tên, ngày sinh, địa chỉ, số điện thoại;</li>
                        <li>Ảnh cá nhân, mã học sinh, tài khoản mạng xã hội;</li>
                        <li>Email, mật khẩu, vị trí, lịch học.</li>
                    </ul>
                    <p class="mt-2 italic text-red-600">📸 Ví dụ: Một bạn đăng ảnh thẻ học sinh có ghi tên và trường. Người lạ có thể dễ dàng tìm ra địa chỉ chỉ bằng vài cú tìm kiếm!</p>
                    <h4 class="text-xl font-bold mt-6 mb-3 text-blue-700">3. Giữ an toàn cho tài khoản</h4>
                    <p>🔑 Mật khẩu mạnh là lớp khóa đầu tiên. Một mật khẩu an toàn cần:</p>
                    <ul class="list-disc list-inside space-y-1 pl-4">
                        <li>Ít nhất 8 ký tự, gồm chữ hoa – chữ thường – số – ký tự đặc biệt.</li>
                        <li>Dễ nhớ với em, nhưng khó đoán với người khác.</li>
                    </ul>
                    <p class="mt-2">✅ Ví dụ: Uka@2025!, HaLong#9x!</p>
                    <p>🚫 Tránh: 123456, uka2025, ngày sinh.</p>
                    <p class="italic text-blue-600">💬 Mẹo nhỏ: Hãy biến một câu quen thuộc thành mật khẩu! “UKA là ngôi trường tuyệt vời” → UkaLaNgT@2025</p>
                    <p class="mt-4">📱 Xác thực hai lớp (2FA) – lớp khóa thứ hai. Ngay cả khi kẻ xấu biết mật khẩu, họ vẫn không thể vào tài khoản nếu em bật xác thực hai bước. Khi đăng nhập, em sẽ nhận được mã OTP qua điện thoại hoặc email.</p>
                    <p class="font-bold text-green-700">💡 Hãy bật tính năng “Xác thực hai lớp” trong phần Bảo mật của Zalo, Facebook, TikTok hay Gmail. Đây là “lá chắn kép” cho tài khoản của em!</p>
                    <h4 class="text-xl font-bold mt-6 mb-3 text-blue-700">4. Cài đặt quyền riêng tư</h4>
                    <p>Không phải ai cũng nên thấy bài đăng của em.</p>
                    <ul class="list-disc list-inside space-y-1 pl-4">
                        <li>Chỉ để bạn bè thật xem bài viết.</li>
                        <li>Không công khai hình ảnh gia đình hay địa chỉ nhà.</li>
                        <li>Khi đăng ảnh nhóm, xin phép các bạn trước.</li>
                    </ul>
                    <p class="mt-2 italic text-red-600">📍 Ví dụ: Một bạn gắn vị trí “Trường UKA Hạ Long” dưới mỗi bài đăng. → Người lạ có thể biết thời gian học, vị trí lớp học – gây nguy cơ bị theo dõi.</p>
                    <p class="mt-2 font-bold">🧠 Gợi ý: Trước khi đăng bất kỳ hình ảnh nào, hãy tự hỏi: “Nếu cả thế giới nhìn thấy điều này, mình có thấy thoải mái không?”</p>
                    <h4 class="text-xl font-bold mt-6 mb-3 text-blue-700">5. Tôn trọng người khác – cũng là bảo vệ chính mình</h4>
                    <p>Khi sử dụng mạng xã hội, mỗi em không chỉ giữ an toàn cho bản thân mà còn góp phần xây dựng môi trường mạng lành mạnh.</p>
                    <ul class="list-disc list-inside space-y-1 pl-4">
                        <li>Không chia sẻ, bình luận ác ý hay tin giả.</li>
                        <li>Không đăng ảnh bạn bè khi chưa được đồng ý.</li>
                        <li>Không phát tán nội dung nhạy cảm, dù chỉ “cho vui”.</li>
                    </ul>
                    <p class="mt-2 italic text-blue-600">🌼 Hãy là người dùng mạng văn minh, biết tôn trọng quyền riêng tư – vì an toàn trực tuyến là an toàn của cả cộng đồng.</p>
                    <h4 class="text-xl font-bold mt-6 mb-3 text-green-700">🌈 Em cần ghi nhớ</h4>
                    <ul class="list-disc list-inside space-y-1 pl-4 font-semibold">
                        <li>Không chia sẻ thông tin cá nhân tùy tiện.</li>
                        <li>Sử dụng mật khẩu mạnh và bật xác thực hai lớp.</li>
                        <li>Cài đặt quyền riêng tư, không gắn vị trí thật.</li>
                        <li>Tôn trọng quyền riêng tư của người khác.</li>
                    </ul>
                    <p class="mt-4 font-bold text-center text-lg">💖 An toàn trên mạng bắt đầu từ chính ý thức của mỗi người. 💖</p>
                    <p class="mt-4 text-center font-bold text-blue-800 text-lg">💬 Lời nhắn của chiến dịch</p>
                    <p class="mt-2 text-center font-bold text-blue-800 text-lg">🔐 “Hãy khóa an toàn cho dữ liệu – mở rộng kết nối bằng sự tử tế.”</p>
                    <p>Mỗi học sinh UKA là một người gác cổng số, cùng nhau giữ môi trường mạng an toàn, nhân văn, không một mình. Bài học này là bước đầu tiên trong hành trình xây dựng “Kháng thể số” của mỗi học sinh UKA.</p>
                    <p>Hãy cùng tham gia:</p>
                    <ul class="list-disc list-inside space-y-1 pl-4">
                        <li>Hoàn thành quiz “Bảo vệ cá nhân – Kháng thể số cấp 1”,</li>
                        <li>Đổi avatar chiến dịch</li>
                        <li>Check-in xác nhận đã bật xác thực hai lớp và kiểm tra quyền riêng tư trên tài khoản mạng xã hội cá nhân.</li>
                        <li>Đăng thông điệp của lớp với hashtag #KhongMotMinh #Niemtinso #CungNhauAnToanTrucTuyen #UKAcademyHaLong</li>
                    </ul>
                `,
                questions: [
                    { type: 'mcq', question: "Câu 1: Mật khẩu nào an toàn nhất?", options: ["A. ukahalong123", "B. 12345678", "C. Uka@2025!", "D. halonguka"], answer: "C. Uka@2025!" },
                    { type: 'mcq', question: "Câu 2: Khi người lạ xin ảnh cá nhân, em nên:", options: ["A. Gửi ngay", "B. Chia sẻ qua nick phụ", "C. Từ chối và báo cho GVCN/cha mẹ", "D. Xoá tin nhắn"], answer: "C. Từ chối và báo cho GVCN/cha mẹ" },
                    { type: 'mcq', question: "Câu 3: “Xác thực hai lớp” giúp:", options: ["A. Đăng nhập nhanh hơn", "B. Ngăn người lạ truy cập dù biết mật khẩu", "C. Giữ mật khẩu ngắn", "D. Lưu mật khẩu tự động"], answer: "B. Ngăn người lạ truy cập dù biết mật khẩu" },
                    { type: 'mcq', question: "Câu 4: Khi đăng ảnh nhóm bạn cần:", options: ["A. Đăng tự do", "B. Tag hết bạn", "C. Xin phép trước khi đăng", "D. Không cần vì là bạn"], answer: "C. Xin phép trước khi đăng" },
                    { type: 'mcq', question: "Câu 5: Khi phát hiện ai đó giả mạo tài khoản của mình:", options: ["A. Bỏ qua", "B. Báo cáo và đổi mật khẩu", "C. Viết status cảnh báo", "D. Tạo tài khoản mới"], answer: "B. Báo cáo và đổi mật khẩu" },
                    { type: 'mcq', question: "Câu 6: Em có đang sử dụng tài khoản mạng xã hội không?", options: ["A. Có", "B. Không"], answer: null },
                    { type: 'file', question: "Câu 7.1: Tuyệt vời! Hãy chụp ảnh màn hình minh chứng em đã bật xác thực bảo mật tài khoản 2 lớp và tải lên đây nhé.", condition: { questionIndex: 5, answer: "A. Có" } },
                    { type: 'checkbox', question: "Câu 7.2: Em hãy đọc kỹ lại các kiến thức về bảo mật 2 lớp và xác nhận đã hiểu rõ thông tin nhé.", condition: { questionIndex: 5, answer: "B. Không" } }
                ]
            },
        };

        // --- FUNCTIONS ---
        function showView(viewToShow) {
            [registrationView, theoryView, quizView].forEach(view => view.classList.add('hidden'));
            viewToShow.classList.remove('hidden');
        }

        function showTheory(week) {
            currentQuiz = quizzes[week];
            userAnswers = new Array(currentQuiz.questions.length).fill(null);
            theoryTitle.textContent = `Kiến thức ${currentQuiz.title}`;
            theoryContent.innerHTML = currentQuiz.theory;
            showView(theoryView);
        }

        function displayQuiz() {
            document.getElementById('quiz-title').textContent = currentQuiz.title;
            document.getElementById('quiz-description').textContent = currentQuiz.description;
            quizContainer.innerHTML = '';
            currentQuiz.questions.forEach((q, index) => {
                const qElem = document.createElement('div');
                qElem.className = 'border-b pb-4';
                qElem.id = `question-${index}`;
                if (q.condition) qElem.classList.add('hidden');
                
                let contentHTML = `<p class="font-semibold text-lg mb-2">${q.question}</p>`;
                if (q.type === 'mcq') {
                    contentHTML += `<div class="space-y-2">` + q.options.map(opt => `<div class="quiz-option border rounded-lg p-3 cursor-pointer mt-2" data-q-index="${index}" data-option="${opt}">${opt}</div>`).join('') + `</div>`;
                } else if (q.type === 'file') {
                    contentHTML += `<input type="file" class="w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100"/>`;
                } else if (q.type === 'checkbox') {
                    contentHTML += `<label class="flex items-center space-x-3 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"/> <span class="text-gray-700">Tôi xác nhận đã hiểu và nắm rõ thông tin.</span></label>`;
                }
                qElem.innerHTML = contentHTML;
                quizContainer.appendChild(qElem);
            });
            
            document.querySelectorAll('.quiz-option').forEach(el => {
                el.addEventListener('click', e => {
                    const qIndex = parseInt(e.currentTarget.dataset.qIndex);
                    const option = e.currentTarget.dataset.option;
                    userAnswers[qIndex] = option;
                    document.querySelectorAll(`.quiz-option[data-q-index="${qIndex}"]`).forEach(opt => opt.classList.remove('selected'));
                    e.currentTarget.classList.add('selected');
                    if (qIndex === 5) handleConditionalQuestions(option);
                });
            });
        }

        function handleConditionalQuestions(answer) {
            currentQuiz.questions.forEach((q, index) => {
                if (q.condition) {
                    const qElem = document.getElementById(`question-${index}`);
                    if (q.condition.questionIndex === 5 && q.condition.answer === answer) {
                        qElem.classList.remove('hidden');
                    } else {
                        qElem.classList.add('hidden');
                    }
                }
            });
        }
        
        function submitQuiz() {
            submitQuizBtn.disabled = true;
            quizContainer.classList.add('submitted');
            let score = 0;
            let totalScorable = 0;
            currentQuiz.questions.forEach((q, index) => {
                if (q.type === 'mcq' && q.answer) {
                    totalScorable++;
                    if (userAnswers[index] === q.answer) score++;
                    document.querySelectorAll(`.quiz-option[data-q-index="${index}"]`).forEach(opt => {
                        const optionText = opt.dataset.option;
                        if (optionText === q.answer) opt.classList.add('correct');
                        else if (optionText === userAnswers[index]) opt.classList.add('incorrect');
                    });
                }
            });
            const percentage = totalScorable > 0 ? Math.round((score / totalScorable) * 100) : 100;
            saveDataToGoogleSheets("week1", percentage);
            setTimeout(() => showResult(percentage), 1500); 
        }

        function showResult(percentage) {
            showView(quizView); 
            resultModal.classList.remove('hidden');
            setTimeout(() => resultContent.classList.remove('scale-95', 'opacity-0'), 100);

            document.getElementById('result-score').innerHTML = `Điểm trắc nghiệm: <strong>${percentage}%</strong>`;
            
            const robotCongratsEl = document.getElementById('robot-congrats-text');
            const messageEl = document.getElementById('result-message');
            const titleEl = document.getElementById('result-title');
            const cupContainer = document.getElementById('cup-container');

            if (percentage >= 80) {
                titleEl.textContent = "Xuất sắc!";
                cupContainer.style.display = 'block';
                triggerFireworks();
                
                normalResultContent.classList.add('hidden');
                robotMessageContent.classList.remove('hidden');
                robotCongratsEl.textContent = `UKA Hạ Long chúc mừng ${studentInfo.name} đã vượt qua thử thách và đạt được huy hiệu tuần “Chiến binh an toàn số”!`;
            } else {
                titleEl.textContent = "Cố gắng hơn nhé!";
                messageEl.textContent = `Hãy ôn lại kiến thức và thử lại nhé, ${studentInfo.name}!`;
                cupContainer.style.display = 'none';
                normalResultContent.classList.remove('hidden');
                robotMessageContent.classList.add('hidden');
            }
        }

        function triggerFireworks() {
            const duration = 4 * 1000; // Run for 4 seconds
            const animationEnd = Date.now() + duration;
            const myConfetti = confetti.create(fireworksCanvas, {
                resize: true,
                useWorker: true
            });

            // More colors for the fireworks
            const colors = ['#00529D', '#FFD700', '#FFFFFF', '#4169E1', '#FF6347', '#32CD32'];

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);
                
                // launch a few confetti from random positions on the left and right
                myConfetti({
                    startVelocity: 30,
                    spread: 360,
                    ticks: 60,
                    zIndex: 100,
                    particleCount,
                    origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
                    colors: colors
                });
                myConfetti({
                    startVelocity: 30,
                    spread: 360,
                    ticks: 60,
                    zIndex: 100,
                    particleCount,
                    origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
                    colors: colors
                });
            }, 250);
        }
        
        async function saveDataToGoogleSheets(week, score) {
            const scriptURL = 'THAY_THẾ_BẰNG_URL_CỦA_THẦY'; // <-- IMPORTANT: Replace this!
            const formData = new FormData();
            formData.append('Hoten', studentInfo.name);
            formData.append('Email', studentInfo.email);
            formData.append('Lop', studentInfo.class);
            // formData.append('Truong', studentInfo.school);
            formData.append('Tuan', week);
            formData.append('Diemso', score);
            try {
                 await fetch(scriptURL, { method: 'POST', body: formData });
            } catch (error) {
                console.error('Lỗi khi gửi dữ liệu:', error.message);
            }
        }
        
        function resetApp() {
            resultModal.classList.add('hidden');
            quizContainer.classList.remove('submitted');
            submitQuizBtn.disabled = false;
            normalResultContent.classList.remove('hidden');
            robotMessageContent.classList.add('hidden');
            showView(registrationView);
        }

        function retryFromTheory() {
            resultModal.classList.add('hidden');
            quizContainer.classList.remove('submitted');
            submitQuizBtn.disabled = false;
            showTheory('week1');
        }

        // --- EVENT LISTENERS ---
        registrationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            studentInfo.name = document.getElementById('student-name').value;
            studentInfo.email = document.getElementById('student-email').value;
            studentInfo.class = document.getElementById('student-class').value;
            // studentInfo.school = document.getElementById('student-school').value;
            if (!studentInfo.name || !studentInfo.email || !studentInfo.class) {
                alert('Vui lòng điền đầy đủ thông tin.');
                return;
            }
            showTheory('week1');
        });

        startQuizBtn.addEventListener('click', () => {
            showView(quizView);
            displayQuiz();
        });

        submitQuizBtn.addEventListener('click', submitQuiz);
        closeModalBtn.addEventListener('click', resetApp);
        continueBtn.addEventListener('click', resetApp);
        continueBtnFail.addEventListener('click', retryFromTheory);

        const shareOnFacebook = () => {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(`"${studentInfo.name}" đã đạt danh hiệu "Chiến binh an toàn số" trong chiến dịch Không Một Mình!`);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
        };
        
        const shareOnZalo = () => {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://zalo.me/share/link?url=${url}`, '_blank');
        };
        
        document.querySelectorAll('#share-fb-2').forEach(btn => btn.addEventListener('click', shareOnFacebook));
        document.querySelectorAll('#share-zalo-2').forEach(btn => btn.addEventListener('click', shareOnZalo));

    </script>
</body>
</html>


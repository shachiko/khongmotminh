<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Không Một Mình – Cùng nhau an toàn trực tuyến</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        .quiz-option:hover {
            background-color: #DBEAFE; /* Light blue on hover */
        }
        .quiz-option.selected {
            background-color: #93C5FD; /* Darker blue when selected */
            border-color: #2563EB;
        }
        /* Style for correct answer */
        .quiz-option.correct {
            background-color: #D1FAE5; /* Green-100 */
            border-color: #059669; /* Green-600 */
            color: #047857; /* Green-700 */
            font-weight: bold;
        }
        /* Style for incorrect answer */
        .quiz-option.incorrect {
            background-color: #FEE2E2; /* Red-100 */
            border-color: #E11D48; /* Rose-600 */
            color: #BE123C; /* Rose-700 */
        }
        /* Disable clicks after submission */
        #quiz-container.submitted .quiz-option {
            pointer-events: none;
            cursor: default;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-800 flex flex-col min-h-screen">

    <div id="app" class="container mx-auto p-4 max-w-4xl flex flex-col flex-grow">

        <!-- Header -->
        <header class="text-center my-8">
            <img id="logo" src="https://placehold.co/100x100/FFFFFF/00529D?text=Logo" alt="Logo Không Một Mình" class="w-20 h-20 mx-auto mb-4 rounded-full"
                 onerror="this.onerror=null;this.src='https://placehold.co/100x100/FFFFFF/00529D?text=Logo';">
            <h1 class="text-4xl font-bold text-blue-800">Không Một Mình</h1>
            <p class="text-lg text-blue-600">Cùng nhau an toàn trực tuyến</p>
        </header>

        <main id="main-content" class="flex-grow flex items-center justify-center">
            <!-- Registration View -->
            <div id="registration-view" class="bg-white p-8 rounded-xl shadow-lg text-center w-full">
                 <img id="banner" src="https://placehold.co/800x400/00529D/FFFFFF?text=Chiến+dịch+Không+Một+Mình" alt="Banner Chiến dịch" class="w-full h-64 object-cover rounded-lg mb-6"
                      onerror="this.onerror=null;this.src='https://placehold.co/800x400/00529D/FFFFFF?text=Banner';">
                <h2 class="text-2xl font-bold mb-4">Tham gia Thử thách Bảo vệ</h2>
                <p class="mb-6">Hãy điền thông tin để bắt đầu bài kiểm tra hàng tuần và tích luỹ cúp nhé!</p>
                <form id="registration-form" class="space-y-4 max-w-sm mx-auto">
                    <input type="text" id="student-name" placeholder="Họ và tên của bạn" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <input type="email" id="student-email" placeholder="Email nhận chứng nhận" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">CHỦ ĐỀ 1: BẢO VỆ CÁ NHÂN</button>
                </form>
            </div>

            <!-- Quiz View -->
            <div id="quiz-view" class="hidden bg-white p-8 rounded-xl shadow-lg w-full">
                <h2 id="quiz-title" class="text-2xl font-bold mb-2 text-center">Bài kiểm tra Tuần 1</h2>
                <p id="quiz-description" class="text-center mb-6">Chọn câu trả lời đúng nhất cho các câu hỏi dưới đây.</p>
                <div id="quiz-container" class="space-y-6">
                    <!-- Questions will be dynamically inserted here -->
                </div>
                <button id="submit-quiz" class="mt-8 w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400">Nộp bài</button>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="text-center py-6 text-sm text-gray-500">
        <p>&copy; 2025 - Sản phẩm thuộc bản quyền của trường UK ACADEMY HA LONG</p>
    </footer>

    <!-- Result Modal -->
    <div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-md w-full relative transform transition-all scale-95 opacity-0" id="result-content">
            <h2 id="result-title" class="text-3xl font-bold text-yellow-500 mb-4">Chúc mừng!</h2>
            <div id="cup-container" class="my-4">
                <svg class="w-32 h-32 mx-auto text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15h14a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM8 16a2 2 0 114 0H8z"></path><path fill-rule="evenodd" d="M10 0a1 1 0 011 1v.065a8.002 8.002 0 015.657 5.657A1 1 0 0117 8v3.586l1.707 1.707a1 1 0 01-1.414 1.414L16 13.414V8a6.002 6.002 0 00-5-5.917V1a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
            </div>
            <p id="result-message" class="text-xl font-semibold text-gray-700 my-4">Bạn là người bảo vệ tuyệt vời!</p>
            <p id="result-score" class="text-lg mb-6">Điểm số của bạn: <strong>100%</strong></p>
            <div class="flex justify-center space-x-4">
                 <button id="share-fb" class="bg-blue-800 text-white font-bold py-2 px-5 rounded-lg">Chia sẻ Facebook</button>
                 <button id="share-zalo" class="bg-blue-500 text-white font-bold py-2 px-5 rounded-lg">Chia sẻ Zalo</button>
            </div>
            <button id="close-modal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
        </div>
    </div>
    
    <!-- Canvas for fireworks -->
    <canvas id="fireworks-canvas" class="fixed top-0 left-0 w-full h-full pointer-events-none z-50"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
        const registrationView = document.getElementById('registration-view');
        const quizView = document.getElementById('quiz-view');
        const resultModal = document.getElementById('result-modal');
        const resultContent = document.getElementById('result-content');
        const registrationForm = document.getElementById('registration-form');
        const quizContainer = document.getElementById('quiz-container');
        const submitQuizBtn = document.getElementById('submit-quiz');
        const closeModalBtn = document.getElementById('close-modal');
        const fireworksCanvas = document.getElementById('fireworks-canvas');

        let studentName = '';
        let studentEmail = '';
        let currentQuiz = {};
        let userAnswers = [];

        // --- DỮ LIỆU BÀI KIỂM TRA (Thầy sẽ tự thay đổi hàng tuần) ---
        const quizzes = {
            week1: {
                title: "CHỦ ĐỀ 1: BẢO VỆ CÁ NHÂN",
                description: "Nhận biết các tình huống nguy hiểm trên mạng.",
                questions: [
                    {
                        question: "Nếu một người lạ trên mạng rủ bạn chơi game và hứa cho bạn vật phẩm hiếm, bạn nên làm gì?",
                        options: [
                            "Đồng ý ngay và cho họ thông tin tài khoản.",
                            "Hỏi ý kiến bố mẹ hoặc người lớn tin cậy.",
                            "Từ chối và chặn người đó.",
                            "Cả B và C đều đúng."
                        ],
                        answer: "Cả B và C đều đúng."
                    },
                    {
                        question: "Thông tin nào sau đây là an toàn để chia sẻ công khai trên mạng?",
                        options: [
                            "Địa chỉ nhà riêng.",
                            "Số điện thoại của bố mẹ.",
                            "Tên trường học và lớp học của bạn.",
                            "Không có thông tin nào ở trên là an toàn."
                        ],
                        answer: "Không có thông tin nào ở trên là an toàn."
                    },
                    // Thầy có thể thêm các câu hỏi khác vào đây
                ]
            },
            // Thầy có thể thêm week2, week3... ở đây
        };

        // --- CÁC HÀM XỬ LÝ ---

        function startQuiz(week) {
            studentName = document.getElementById('student-name').value;
            studentEmail = document.getElementById('student-email').value;

            if (!studentName || !studentEmail) {
                alert('Vui lòng điền đầy đủ họ tên và email.');
                return;
            }

            currentQuiz = quizzes[week];
            userAnswers = new Array(currentQuiz.questions.length).fill(null);
            
            displayQuiz();
            
            registrationView.classList.add('hidden');
            quizView.classList.remove('hidden');
        }

        function displayQuiz() {
            document.getElementById('quiz-title').textContent = currentQuiz.title;
            document.getElementById('quiz-description').textContent = currentQuiz.description;
            quizContainer.innerHTML = '';

            currentQuiz.questions.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'border-b pb-4';
                
                let optionsHTML = q.options.map((option, oIndex) => `
                    <div class="quiz-option border rounded-lg p-3 cursor-pointer mt-2" data-q-index="${index}" data-option="${option}">
                        ${option}
                    </div>
                `).join('');

                questionElement.innerHTML = `
                    <p class="font-semibold text-lg mb-2">${index + 1}. ${q.question}</p>
                    <div class="space-y-2">${optionsHTML}</div>
                `;
                quizContainer.appendChild(questionElement);
            });

            document.querySelectorAll('.quiz-option').forEach(el => {
                el.addEventListener('click', (e) => {
                    const qIndex = e.currentTarget.dataset.qIndex;
                    const option = e.currentTarget.dataset.option;
                    
                    userAnswers[qIndex] = option;
                    
                    // Highlight selected option
                    const optionsForQuestion = document.querySelectorAll(`.quiz-option[data-q-index="${qIndex}"]`);
                    optionsForQuestion.forEach(opt => opt.classList.remove('selected'));
                    e.currentTarget.classList.add('selected');
                });
            });
        }
        
        function submitQuiz() {
            // Vô hiệu hóa nút nộp bài và các lựa chọn
            submitQuizBtn.disabled = true;
            quizContainer.classList.add('submitted');

            let score = 0;
            currentQuiz.questions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                const correctAnswer = q.answer;

                if (userAnswer === correctAnswer) {
                    score++;
                }
                
                // Hiển thị đáp án đúng/sai
                const optionsForQuestion = document.querySelectorAll(`.quiz-option[data-q-index="${index}"]`);
                optionsForQuestion.forEach(opt => {
                    const optionText = opt.dataset.option;
                    
                    if (optionText === correctAnswer) {
                        opt.classList.add('correct'); // Tô màu xanh cho đáp án đúng
                    } else if (optionText === userAnswer && userAnswer !== correctAnswer) {
                        opt.classList.add('incorrect'); // Tô màu đỏ cho đáp án sai người dùng chọn
                    }
                });
            });

            const totalQuestions = currentQuiz.questions.length;
            const percentage = Math.round((score / totalQuestions) * 100);
            
            saveDataToGoogleSheets(studentName, studentEmail, "week1", percentage);

            // Hiện kết quả sau 1.5 giây để học sinh xem đáp án
            setTimeout(() => {
                showResult(percentage);
            }, 1500); 
        }

        function showResult(percentage) {
            resultModal.classList.remove('hidden');
            
            // Animate modal pop-in
            setTimeout(() => {
                resultContent.classList.remove('scale-95', 'opacity-0');
                resultContent.classList.add('scale-100', 'opacity-100');
            }, 100);

            const scoreEl = document.getElementById('result-score');
            const titleEl = document.getElementById('result-title');
            const messageEl = document.getElementById('result-message');
            const cupContainer = document.getElementById('cup-container');
            
            scoreEl.innerHTML = `Điểm số của bạn: <strong>${percentage}%</strong>`;

            if (percentage >= 80) {
                titleEl.textContent = "Xuất sắc!";
                messageEl.textContent = "Bạn là người bảo vệ tuyệt vời!";
                cupContainer.style.display = 'block';
                triggerFireworks();
            } else {
                titleEl.textContent = "Cố gắng hơn nhé!";
                messageEl.textContent = "Hãy ôn lại kiến thức và thử lại vào tuần sau!";
                cupContainer.style.display = 'none';
            }
        }

        function triggerFireworks() {
            const myConfetti = confetti.create(fireworksCanvas, {
                resize: true,
                useWorker: true
            });
            
            const duration = 5 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 100 };

            function randomInRange(min, max) {
              return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function() {
              const timeLeft = animationEnd - Date.now();

              if (timeLeft <= 0) {
                return clearInterval(interval);
              }

              const particleCount = 50 * (timeLeft / duration);
              myConfetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
              myConfetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        async function saveDataToGoogleSheets(name, email, week, score) {
            // URL này sẽ được thay thế bằng URL của thầy từ Google Apps Script
            const scriptURL = 'THAY_THẾ_BẰNG_URL_CỦA_THẦY';
            
            const formData = new FormData();
            formData.append('name', name);
            formData.append('email', email);
            formData.append('week', week);
            formData.append('score', score);

            try {
                 console.log('Đang gửi dữ liệu:', { name, email, week, score });
                // Khi có URL thật, hãy bỏ comment dòng dưới đây
                // await fetch(scriptURL, { method: 'POST', body: formData });
                console.log('Gửi dữ liệu thành công (mô phỏng)');
            } catch (error) {
                console.error('Lỗi khi gửi dữ liệu:', error.message);
            }
        }
        
        function resetQuiz() {
            quizView.classList.add('hidden');
            registrationView.classList.remove('hidden');

            quizContainer.innerHTML = '';
            quizContainer.classList.remove('submitted');
            userAnswers = [];
            currentQuiz = {};
            
            submitQuizBtn.disabled = false;
        }

        // --- EVENT LISTENERS ---
        registrationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            startQuiz('week1');
        });

        submitQuizBtn.addEventListener('click', submitQuiz);

        closeModalBtn.addEventListener('click', () => {
             resultModal.classList.add('hidden');
             resetQuiz();
        });

        document.getElementById('share-fb').addEventListener('click', () => {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('Tôi đã tham gia chiến dịch Không Một Mình để bảo vệ bản thân trên không gian mạng!');
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
        });

        document.getElementById('share-zalo').addEventListener('click', () => {
             const url = window.location.href;
             alert(`Sao chép link này và chia sẻ trên Zalo nhé: ${url}`);
        });

        document.getElementById('logo').src = 'logo-tron.png';
        document.getElementById('banner').src = 'Kmm-01.jpg';

    </script>
</body>
</html>


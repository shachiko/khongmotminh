<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhÃ´ng Má»™t MÃ¬nh â€“ CÃ¹ng nhau an toÃ n trá»±c tuyáº¿n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        .quiz-option:hover {
            background-color: #DBEAFE; /* Light blue on hover */
        }
        .quiz-option.selected {
            background-color: #93C5FD; /* Darker blue when selected */
            border-color: #2563EB;
        }
        .quiz-option.correct {
            background-color: #D1FAE5;
            border-color: #059669;
            color: #047857;
            font-weight: bold;
        }
        .quiz-option.incorrect {
            background-color: #FEE2E2;
            border-color: #E11D48;
            color: #BE123C;
        }
        #quiz-container.submitted .quiz-option {
            pointer-events: none;
            cursor: default;
        }
        /* Style for theory sections */
        .theory-section {
            margin-top: 1.5rem; /* Reduced margin */
            padding-top: 1rem; /* Reduced padding */
            /* border-top: 1px solid #e5e7eb; Removed border for continuous flow */
        }
        .theory-section h4 {
             margin-top: 1.5rem; /* mt-6 */
             margin-bottom: 0.75rem; /* mb-3 */
             font-size: 1.25rem; /* text-xl */
             font-weight: 700; /* font-bold */
        }
         .theory-section h5 {
             margin-top: 1rem; /* mt-4 */
             margin-bottom: 0.5rem; /* mb-2 */
             font-size: 1.125rem; /* text-lg */
             font-weight: 600; /* font-semibold */
         }

    </style>
</head>
<body class="bg-blue-50 text-gray-800 flex flex-col min-h-screen">

    <div id="app" class="container mx-auto p-4 max-w-4xl flex flex-col flex-grow">

        <header class="text-center my-8">
            <img id="logo" src="logo-tron.png" alt="Logo KhÃ´ng Má»™t MÃ¬nh" class="w-20 h-20 mx-auto mb-4 rounded-full"
                 onerror="this.onerror=null;this.src='https://placehold.co/100x100/FFFFFF/00529D?text=Logo';">
            <h1 class="text-4xl font-bold text-blue-800">KhÃ´ng Má»™t MÃ¬nh</h1>
            <p class="text-lg text-blue-600">CÃ¹ng nhau an toÃ n trá»±c tuyáº¿n</p>
        </header>

        <main id="main-content" class="flex-grow flex items-center justify-center">
            <div id="registration-view" class="bg-white p-8 rounded-xl shadow-lg text-center w-full">
                <img id="banner" src="Kmm-01.jpg" alt="Banner Chiáº¿n dá»‹ch" class="w-full h-64 object-cover rounded-lg mb-6"
                     onerror="this.onerror=null;this.src='https://placehold.co/800x400/00529D/FFFFFF?text=Banner';">
                <h2 class="text-2xl font-bold mb-4">Tham gia Thá»­ thÃ¡ch Báº£o vá»‡</h2>
                <p class="mb-6">HÃ£y Ä‘iá»n thÃ´ng tin Ä‘á»ƒ báº¯t Ä‘áº§u bÃ i kiá»ƒm tra hÃ ng tuáº§n vÃ  tÃ­ch luá»¹ cÃºp nhÃ©!</p>
                <form id="registration-form" class="space-y-4 max-w-sm mx-auto">
                    <input type="text" id="student-name" placeholder="Há» vÃ  tÃªn cá»§a báº¡n" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <input type="email" id="student-email" placeholder="Email nháº­n chá»©ng nháº­n" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <input type="text" id="student-class" placeholder="Lá»›p" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">Báº®T Äáº¦U TUáº¦N 4</button>
                </form>
            </div>

            <div id="theory-view" class="hidden bg-white p-8 rounded-xl shadow-lg w-full">
                <h2 id="theory-title" class="text-2xl font-bold mb-4 text-center">Kiáº¿n thá»©c Tuáº§n 4</h2> <div id="theory-content" class="text-left mb-6 space-y-4 max-h-[60vh] overflow-y-auto pr-4">
                    </div>
                <button id="start-quiz-btn" class="mt-6 w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors">ÄÃ£ hiá»ƒu, Báº¯t Ä‘áº§u lÃ m bÃ i</button>
            </div>

            <div id="quiz-view" class="hidden bg-white p-8 rounded-xl shadow-lg w-full">
                <h2 id="quiz-title" class="text-2xl font-bold mb-2 text-center">BÃ i kiá»ƒm tra Tuáº§n 4</h2> <p id="quiz-description" class="text-center mb-6">Chá»n cÃ¢u tráº£ lá»i Ä‘Ãºng nháº¥t.</p>
                <div id="quiz-container" class="space-y-6"></div>
                <button id="submit-quiz" class="mt-8 w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400">Ná»™p bÃ i</button>
            </div>
        </main>
    </div>

    <footer class="text-center py-6 text-sm text-gray-500">
        <p>&copy; 2025 - Sáº£n pháº©m thuá»™c báº£n quyá»n cá»§a trÆ°á»ng UK ACADEMY HA LONG</p>
    </footer>

    <div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-md w-full relative transform transition-all scale-95 opacity-0" id="result-content">
            <div id="normal-result-content">
                <h2 id="result-title" class="text-3xl font-bold text-yellow-500 mb-4"></h2>
                <div id="cup-container" class="my-4">
                    <svg class="w-32 h-32 mx-auto text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15h14a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM8 16a2 2 0 114 0H8z"></path><path fill-rule="evenodd" d="M10 0a1 1 0 011 1v.065a8.002 8.002 0 015.657 5.657A1 1 0 0117 8v3.586l1.707 1.707a1 1 0 01-1.414 1.414L16 13.414V8a6.002 6.002 0 00-5-5.917V1a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </div>
                <p id="result-message" class="text-xl font-semibold text-gray-700 my-4"></p>
                <p id="result-score" class="text-lg mb-6"></p>
                <button id="continue-btn-fail" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors mt-4">Tiáº¿p tá»¥c lÃ m láº¡i</button>
            </div>

            <div id="robot-message-content" class="hidden">
                <img src="robot-uka.png" alt="Robot UKA Háº¡ Long" class="w-40 h-40 mx-auto mb-4 object-contain"
                     onerror="this.onerror=null;this.src='https://placehold.co/150x150/FFFFFF/00529D?text=Robot';">
                <p id="robot-congrats-text" class="text-xl font-bold text-blue-700 mb-4"></p>
                <div class="flex justify-center space-x-4 mb-4">
                    <button id="share-fb-2" class="bg-blue-800 text-white font-bold py-2 px-5 rounded-lg">Chia sáº» Facebook</button>
                    <button id="share-zalo-2" class="bg-blue-500 text-white font-bold py-2 px-5 rounded-lg">Chia sáº» Zalo</button>
                </div>
                <button id="continue-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors mt-4">Tiáº¿p tá»¥c</button>
            </div>
            
            <button id="close-modal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
        </div>
    </div>
    
    <canvas id="fireworks-canvas" class="fixed top-0 left-0 w-full h-full pointer-events-none z-50"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
        // DOM Elements
        const registrationView = document.getElementById('registration-view');
        const theoryView = document.getElementById('theory-view');
        const quizView = document.getElementById('quiz-view');
        const resultModal = document.getElementById('result-modal');
        const resultContent = document.getElementById('result-content');
        const normalResultContent = document.getElementById('normal-result-content');
        const robotMessageContent = document.getElementById('robot-message-content');
        const registrationForm = document.getElementById('registration-form');
        const quizContainer = document.getElementById('quiz-container');
        const submitQuizBtn = document.getElementById('submit-quiz');
        const closeModalBtn = document.getElementById('close-modal');
        const continueBtn = document.getElementById('continue-btn');
        const continueBtnFail = document.getElementById('continue-btn-fail');
        const fireworksCanvas = document.getElementById('fireworks-canvas');
        const theoryContent = document.getElementById('theory-content');
        const theoryTitle = document.getElementById('theory-title');
        const startQuizBtn = document.getElementById('start-quiz-btn');

        // State
        let studentInfo = { name: '', email: '', class: '' };
        // Giá»¯ nguyÃªn key 'week1' vÃ¬ chá»‰ cÃ³ 1 bá»™ dá»¯ liá»‡u, nhÆ°ng sáº½ gá»­i 'week4' sang Apps Script
        let currentQuizKey = 'week1'; 
        let currentQuiz = {};
        let userAnswers = [];
        
        // --- QUIZ DATA ---
        const quizzes = {
            week1: { // Dá»¯ liá»‡u váº«n giá»¯ key 'week1' Ä‘á»ƒ code hiá»‡n táº¡i cháº¡y Ä‘Æ°á»£c
                // ===== Báº®T Äáº¦U Ná»˜I DUNG THAY THáº¾ TUáº¦N 4 =====
                title: "CHá»¦ Äá»€ 4: CHIA Sáºº KIáº¾N THá»¨C", 
                description: "Hiá»ƒu rÃµ nguyÃªn táº¯c 3Ä vÃ  trÃ¡ch nhiá»‡m cá»§a CÃ´ng dÃ¢n sá»‘.", 
                theory: `
                    <div class="theory-section">
                        <h4 class="text-xl font-bold mb-3 text-purple-700">ğŸŒˆ Sau ba tuáº§n Ä‘á»“ng hÃ nh, em Ä‘Ã£ biáº¿t cÃ¡ch:</h4>
                        <ul class="list-disc list-inside space-y-1 pl-4">
                            <li>Giá»¯ an toÃ n cho báº£n thÃ¢n,</li>
                            <li>Nháº­n diá»‡n nguy cÆ¡ vÃ  lá»«a Ä‘áº£o,</li>
                            <li>Pháº£n xáº¡ Ä‘Ãºng khi gáº·p tÃ¬nh huá»‘ng xáº¥u.</li>
                        </ul>
                        <p class="mt-2">Giá» Ä‘Ã¢y, em Ä‘Ã£ trá»Ÿ thÃ nh â€œchiáº¿n binh sá»‘â€ â€“ ngÆ°á»i cÃ³ thá»ƒ lan tá»a giÃ¡ trá»‹ tÃ­ch cá»±c, báº£o vá»‡ báº¡n bÃ¨ vÃ  cá»™ng Ä‘á»“ng máº¡ng.</p>
                    </div>

                    <div class="theory-section">
                        <h4 class="text-purple-700">1. NguyÃªn táº¯c 3Ä khi chia sáº»: ÄÃºng â€“ Äá»§ â€“ Äáº¹p</h4>
                        <p class="italic">â€œChia sáº» lÃ  quyá»n, nhÆ°ng chia sáº» tháº¿ nÃ o cho cÃ³ trÃ¡ch nhiá»‡m lÃ  lá»±a chá»n cá»§a má»—i ngÆ°á»i.â€</p>
                        
                        <h5 class="font-semibold text-purple-600 mt-2">a. ÄÃºng â€“ XÃ¡c thá»±c nguá»“n tin</h5>
                        <p>TrÆ°á»›c khi Ä‘Äƒng hoáº·c chia sáº» báº¥t cá»© Ä‘iá»u gÃ¬, hÃ£y kiá»ƒm chá»©ng thÃ´ng tin:</p>
                        <ul class="list-disc list-inside space-y-1 pl-4">
                            <li>BÃ i viáº¿t Ä‘áº¿n tá»« trang chÃ­nh thá»‘ng hay tÃ i khoáº£n áº£o?</li>
                            <li>CÃ³ dáº«n nguá»“n bÃ¡o, cÆ¡ quan hoáº·c ngÆ°á»i tháº­t khÃ´ng?</li>
                            <li>áº¢nh, video cÃ³ thá»ƒ bá»‹ cáº¯t ghÃ©p hoáº·c láº¥y tá»« nÆ¡i khÃ¡c khÃ´ng?</li>
                        </ul>
                        <p class="mt-2 italic"><b>ğŸ“ VÃ­ dá»¥:</b> Tháº¥y bÃ i â€œNam sinh máº¥t tÃ­ch vÃ¬ gameâ€ â†’ Äá»«ng vá»™i chia sáº»! HÃ£y kiá»ƒm tra trÃªn cÃ¡c bÃ¡o uy tÃ­n nhÆ° VnExpress, DÃ¢n trÃ­, VOVâ€¦</p>
                        <p class="mt-2 font-bold">ğŸ§  Má»™t cÃº â€œshareâ€ sai cÃ³ thá»ƒ khiáº¿n tin giáº£ lan nhanh gáº¥p 10 láº§n tin tháº­t.</p>

                        <h5 class="font-semibold text-purple-600 mt-2">b. Äá»§ â€“ NÃªu rÃµ vÃ  trung thá»±c thÃ´ng tin</h5>
                        <p>Nhiá»u báº¡n chá»‰ cáº¯t má»™t pháº§n hÃ¬nh, trÃ­ch má»™t cÃ¢u, khiáº¿n ná»™i dung máº¥t nghÄ©a hoáº·c bá»‹ hiá»ƒu sai. Chia sáº» Ä‘á»§ thÃ´ng tin, Ä‘á»§ bá»‘i cáº£nh sáº½ giÃºp ngÆ°á»i Ä‘á»c hiá»ƒu Ä‘Ãºng.</p>
                        <p class="mt-2 italic"><b>ğŸ“ VÃ­ dá»¥:</b></p>
                        <ul class="list-disc list-inside space-y-1 pl-4">
                            <li>âŒ â€œBáº¡n A bá»‹ cÃ´ng an báº¯t!â€ (thiáº¿u thÃ´ng tin â†’ hiá»ƒu láº§m)</li>
                            <li>âœ… â€œBáº¡n A Ä‘Æ°á»£c má»i lÃ m viá»‡c vÃ¬ liÃªn quan vá»¥ hack tÃ i khoáº£n, hiá»‡n Ä‘Ã£ an toÃ n.â€</li>
                        </ul>
                        <p class="mt-2 italic">ğŸ’¬ HÃ£y chia sáº» nhÆ° má»™t ngÆ°á»i cÃ³ trÃ¡ch nhiá»‡m, khÃ´ng pháº£i Ä‘á»ƒ â€œgÃ¢y chÃº Ã½â€.</p>

                        <h5 class="font-semibold text-purple-600 mt-2">c. Äáº¹p â€“ DÃ¹ng ngÃ´n tá»« tÃ­ch cá»±c, tÃ´n trá»ng ngÆ°á»i khÃ¡c</h5>
                        <p>Máº¡ng xÃ£ há»™i lÃ  nÆ¡i thá»ƒ hiá»‡n báº£n thÃ¢n, nhÆ°ng tÃ´n trá»ng váº«n lÃ  phÃ©p lá»‹ch sá»± cÆ¡ báº£n nháº¥t.</p>
                        <ul class="list-disc list-inside space-y-1 pl-4">
                            <li>KhÃ´ng dÃ¹ng lá»i chÃ¢m chá»c, xÃºc pháº¡m, bÃ¬nh luáº­n Ã¡c Ã½.</li>
                            <li>Biáº¿t cáº£m Æ¡n, xin lá»—i, Ä‘á»™ng viÃªn vÃ  lan tá»a Ä‘iá»u tá»‘t.</li>
                            <li>Náº¿u báº¥t Ä‘á»“ng, hÃ£y tranh luáº­n vÄƒn minh, khÃ´ng xÃºc pháº¡m.</li>
                        </ul>
                        <p class="mt-2 italic"><b>ğŸ“ VÃ­ dá»¥:</b></p>
                        <ul class="list-disc list-inside space-y-1 pl-4">
                            <li>âŒ â€œCáº©n tháº­n Ä‘i, ai cÅ©ng cÃ³ thá»ƒ bá»‹ lá»«a!â€</li>
                            <li>âœ… â€œHÃ£y kiá»ƒm tra nguá»“n tin trÆ°á»›c khi báº¥m vÃ o Ä‘Æ°á»ng link nhÃ©!â€</li>
                        </ul>
                    </div>

                    <div class="theory-section">
                        <h4 class="text-purple-700">2. TrÃ¡ch nhiá»‡m cá»§a CÃ´ng dÃ¢n sá»‘</h4>
                        <p class="italic">â€œCÃ´ng dÃ¢n tá»‘t ngoÃ i Ä‘á»i â€“ cÅ©ng cáº§n lÃ  cÃ´ng dÃ¢n tá»‘t trÃªn máº¡ng.â€</p>
                        <p>Má»—i há»c sinh UKA lÃ  má»™t Ä‘áº¡i sá»© an toÃ n sá»‘, cÃ³ 3 trÃ¡ch nhiá»‡m chÃ­nh:</p>
                        <ol class="list-decimal list-inside space-y-1 pl-4">
                            <li><b>Báº£o vá»‡:</b> Giá»¯ kÃ­n thÃ´ng tin cÃ¡ nhÃ¢n, khÃ´ng lan truyá»n ná»™i dung xáº¥u Ä‘á»™c.</li>
                            <li><b>TÃ´n trá»ng:</b> KhÃ´ng Ä‘Äƒng hÃ¬nh, chia sáº» cÃ¢u chuyá»‡n riÃªng tÆ° cá»§a ngÆ°á»i khÃ¡c khi chÆ°a Ä‘Æ°á»£c Ä‘á»“ng Ã½.</li>
                            <li><b>Lan tá»a:</b> Chia sáº» Ä‘iá»u tÃ­ch cá»±c, khuyáº¿n khÃ­ch ngÆ°á»i khÃ¡c á»©ng xá»­ tá»­ táº¿ vÃ  cÃ¹ng báº£o vá»‡ mÃ´i trÆ°á»ng máº¡ng lÃ nh máº¡nh.</li>
                        </ol>
                        <p class="mt-2 italic">ğŸ“ Náº¿u tháº¥y ná»™i dung Ä‘á»™c háº¡i, Ä‘á»«ng bÃ¬nh luáº­n hay chia sáº» â€“ hÃ£y bÃ¡o cÃ¡o (report) Ä‘á»ƒ ná»n táº£ng xá»­ lÃ½.</p>
                    </div>

                    <div class="theory-section">
                        <h4 class="text-purple-700">3. HÃ nh Ä‘á»™ng cuá»‘i chiáº¿n dá»‹ch</h4>
                        <h5 class="font-semibold text-purple-600 mt-2">ğŸ“ Thá»­ thÃ¡ch â€œLan tá»a an toÃ n sá»‘â€</h5>
                        <ul class="list-disc list-inside space-y-1 pl-4">
                            <li>Viáº¿t má»™t thÃ´ng Ä‘iá»‡p ngáº¯n (1â€“2 cÃ¢u) hoáº·c quay má»™t video 30â€“60 giÃ¢y vá»›i chá»§ Ä‘á»: â€œKhÃ´ng Má»™t MÃ¬nh â€“ CÃ¹ng nhau an toÃ n trá»±c tuyáº¿n.â€</li>
                            <li>ÄÄƒng lÃªn trang cÃ¡ nhÃ¢n kÃ¨m hashtag #KhongMotMinh #Niemtinso #AnToanTrucTuyen #UKAHL</li>
                            <li>Äá»•i avatar khung chiáº¿n dá»‹ch Ä‘á»ƒ thá»ƒ hiá»‡n tinh tháº§n â€œChiáº¿n binh sá»‘â€.</li>
                        </ul>
                        <p class="mt-2 italic"><b>ğŸ“¸ Gá»£i Ã½:</b> â€œAn toÃ n sá»‘ khÃ´ng chá»‰ lÃ  ká»¹ nÄƒng â€“ mÃ  lÃ  cÃ¡ch ta Ä‘á»‘i xá»­ tá»­ táº¿ vá»›i nhau trÃªn máº¡ng.â€</p>
                        
                        <h5 class="font-semibold text-purple-600 mt-2">ğŸŒ» BÃ i há»c tá»•ng káº¿t</h5>
                        <p>Khi má»—i ngÆ°á»i hÃ nh Ä‘á»™ng ÄÃºng â€“ Äá»§ â€“ Äáº¹p, cá»™ng Ä‘á»“ng máº¡ng sáº½ trá»Ÿ thÃ nh má»™t ngÃ´i nhÃ  an toÃ n, thÃ¢n thiá»‡n vÃ  Ä‘áº§y lÃ²ng nhÃ¢n Ã¡i.</p>
                        <p class="mt-2 italic">ğŸ’¬ â€œKhÃ´ng ai an toÃ n náº¿u Ä‘i má»™t mÃ¬nh â€“ nhÆ°ng khi chÃºng ta cÃ¹ng nhau, máº¡ng Internet sáº½ trá»Ÿ nÃªn Ä‘Ã¡ng tin cáº­y hÆ¡n.â€</p>
                    </div>

                    <div class="theory-section text-center">
                        <h4 class="text-xl font-bold mt-6 mb-3 text-blue-800">ğŸŒˆ ThÃ´ng Ä‘iá»‡p tuáº§n 4 â€“ â€œChia sáº» kiáº¿n thá»©câ€</h4>
                        <p class="mt-2 font-bold text-blue-800 text-lg">ğŸŒ» â€œChia sáº» Ä‘iá»u Ä‘Ãºng, lan tá»a Ä‘iá»u tá»‘t.<br>CÃ¹ng nhau biáº¿n Internet thÃ nh nÆ¡i káº¿t ná»‘i tá»­ táº¿.â€</p>
                    </div>
                `,
                questions: [ 
                    { type: 'mcq', question: "CÃ¢u 1. NguyÃªn táº¯c â€œ3Äâ€ trong chia sáº» thÃ´ng tin trÃªn máº¡ng cÃ³ nghÄ©a lÃ  gÃ¬?", options: ["A. ÄÃºng â€“ Äá»§ â€“ Äáº¹p", "B. Äá»c â€“ ÄÄƒng â€“ ÄÃ­nh chÃ­nh", "C. ÄÃºng â€“ Äáº¹p â€“ ÄÆ¡n giáº£n", "D. Äá»c â€“ ÄÃ¡nh giÃ¡ â€“ ÄÄƒng láº¡i"], answer: "A. ÄÃºng â€“ Äá»§ â€“ Äáº¹p" },
                    { type: 'mcq', question: "CÃ¢u 2. HÃ nh Ä‘á»™ng nÃ o sau Ä‘Ã¢y thá»ƒ hiá»‡n trÃ¡ch nhiá»‡m cá»§a cÃ´ng dÃ¢n sá»‘?", options: ["A. Chia sáº» áº£nh báº¡n bÃ¨ khi chÆ°a Ä‘Æ°á»£c phÃ©p", "B. ÄÄƒng láº¡i tin â€œsá»‘câ€ Ä‘á»ƒ cáº£nh bÃ¡o ngÆ°á»i khÃ¡c", "C. BÃ¡o cÃ¡o (Report) khi tháº¥y ná»™i dung Ä‘á»™c háº¡i", "D. BÃ¬nh luáº­n cháº¿ giá»…u Ä‘á»ƒ má»i ngÆ°á»i chÃº Ã½"], answer: "C. BÃ¡o cÃ¡o (Report) khi tháº¥y ná»™i dung Ä‘á»™c háº¡i" },
                    { type: 'mcq', question: "CÃ¢u 3. Khi muá»‘n Ä‘Äƒng bÃ i chia sáº» vá» an toÃ n sá»‘, em nÃªn chá»n cÃ¡ch viáº¿t nÃ o?", options: ["A. â€œCáº©n tháº­n, ai cÅ©ng cÃ³ thá»ƒ bá»‹ lá»«a!â€", "B. â€œMáº¡ng xÃ£ há»™i toÃ n tin giáº£, Ä‘á»«ng tin ai háº¿t!â€", "C. â€œHÃ£y kiá»ƒm tra nguá»“n tin trÆ°á»›c khi báº¥m vÃ o Ä‘Æ°á»ng link nhÃ©!â€", "D. â€œChia sáº» nhanh cho má»i ngÆ°á»i, káº»o muá»™n!â€"], answer: "C. â€œHÃ£y kiá»ƒm tra nguá»“n tin trÆ°á»›c khi báº¥m vÃ o Ä‘Æ°á»ng link nhÃ©!â€" },
                    { type: 'mcq', question: "CÃ¢u 4. Trong thá»­ thÃ¡ch cuá»‘i chiáº¿n dá»‹ch, há»c sinh Ä‘Æ°á»£c khuyáº¿n khÃ­ch lÃ m gÃ¬ Ä‘á»ƒ lan tá»a tinh tháº§n â€œKhÃ´ng Má»™t MÃ¬nhâ€?", options: ["A. ÄÄƒng video 30â€“60 giÃ¢y hoáº·c thÃ´ng Ä‘iá»‡p an toÃ n sá»‘ kÃ¨m hashtag", "B. Viáº¿t bÃ i phÃª phÃ¡n ngÆ°á»i khÃ¡c vi pháº¡m an toÃ n máº¡ng", "C. Gá»­i email cáº£nh bÃ¡o hÃ ng loáº¡t", "D. Chia sáº» láº¡i cÃ¡c tin cáº£nh bÃ¡o chÆ°a kiá»ƒm chá»©ng"], answer: "A. ÄÄƒng video 30â€“60 giÃ¢y hoáº·c thÃ´ng Ä‘iá»‡p an toÃ n sá»‘ kÃ¨m hashtag" },
                    { type: 'mcq', question: "CÃ¢u 5. VÃ¬ sao cáº§n â€œkiá»ƒm chá»©ng nguá»“n tin trÆ°á»›c khi chia sáº»â€?", options: ["A. VÃ¬ máº¡ng xÃ£ há»™i báº¯t buá»™c pháº£i lÃ m váº­y", "B. VÃ¬ Ä‘Ã³ lÃ  cÃ¡ch thá»ƒ hiá»‡n trÃ¬nh Ä‘á»™ há»c sinh", "C. VÃ¬ chia sáº» sai cÃ³ thá»ƒ khiáº¿n tin giáº£ lan truyá»n vÃ  gÃ¢y háº¡i cho ngÆ°á»i khÃ¡c", "D. VÃ¬ báº¡n bÃ¨ sáº½ Ä‘Ã¡nh giÃ¡ tháº¥p náº¿u khÃ´ng lÃ m váº­y"], answer: "C. VÃ¬ chia sáº» sai cÃ³ thá»ƒ khiáº¿n tin giáº£ lan truyá»n vÃ  gÃ¢y háº¡i cho ngÆ°á»i khÃ¡c" }
                ]
                // ===== Káº¾T THÃšC Ná»˜I DUNG THAY THáº¾ TUáº¦N 4 =====
            },
        };

        // --- FUNCTIONS ---
        function showView(viewToShow) {
            [registrationView, theoryView, quizView].forEach(view => view.classList.add('hidden'));
            viewToShow.classList.remove('hidden');
        }

        function showTheory(week) {
            currentQuiz = quizzes[week];
            userAnswers = new Array(currentQuiz.questions.length).fill(null);
            theoryTitle.textContent = `Kiáº¿n thá»©c ${currentQuiz.title}`; 
            theoryContent.innerHTML = currentQuiz.theory;
            showView(theoryView);
        }

        function displayQuiz() {
            document.getElementById('quiz-title').textContent = currentQuiz.title; 
            document.getElementById('quiz-description').textContent = currentQuiz.description; 
            quizContainer.innerHTML = '';
            currentQuiz.questions.forEach((q, index) => {
                const qElem = document.createElement('div');
                qElem.className = 'border-b pb-4';
                qElem.id = `question-${index}`;
                qElem.style.display = 'block';

                let contentHTML = `<p class="font-semibold text-lg mb-2">${q.question}</p>`;
                if (q.type === 'mcq') {
                    contentHTML += `<div class="space-y-2">` + q.options.map(opt => `<div class="quiz-option border rounded-lg p-3 cursor-pointer mt-2" data-q-index="${index}" data-option="${opt}">${opt}</div>`).join('') + `</div>`;
                }
                qElem.innerHTML = contentHTML;
                quizContainer.appendChild(qElem);
            });

            document.querySelectorAll('.quiz-option').forEach(el => {
                el.addEventListener('click', e => {
                    const qIndex = parseInt(e.currentTarget.dataset.qIndex);
                    const option = e.currentTarget.dataset.option;
                    userAnswers[qIndex] = option;
                    document.querySelectorAll(`.quiz-option[data-q-index="${qIndex}"]`).forEach(opt => opt.classList.remove('selected'));
                    e.currentTarget.classList.add('selected');
                });
            });
        }


        function submitQuiz() {
            submitQuizBtn.disabled = true;
            quizContainer.classList.add('submitted');
            let score = 0;
            let totalScorable = 0;
            currentQuiz.questions.forEach((q, index) => {
                if (q.type === 'mcq' && q.answer) {
                    totalScorable++;
                    if (userAnswers[index] === q.answer) score++;
                    document.querySelectorAll(`.quiz-option[data-q-index="${index}"]`).forEach(opt => {
                        const optionText = opt.dataset.option;
                        if (optionText === q.answer) opt.classList.add('correct');
                        else if (optionText === userAnswers[index]) opt.classList.add('incorrect');
                    });
                }
            });
            const percentage = totalScorable > 0 ? Math.round((score / totalScorable) * 100) : 100;
            // Gá»­i 'week4' sang Google Apps Script
            saveDataToGoogleSheets("week4", percentage); 
            setTimeout(() => showResult(percentage), 1500); 
        }

        function showResult(percentage) {
            showView(quizView); 
            resultModal.classList.remove('hidden');
            setTimeout(() => resultContent.classList.remove('scale-95', 'opacity-0'), 100);

            document.getElementById('result-score').innerHTML = `Äiá»ƒm tráº¯c nghiá»‡m: <strong>${percentage}%</strong>`;
            
            const robotCongratsEl = document.getElementById('robot-congrats-text');
            const messageEl = document.getElementById('result-message');
            const titleEl = document.getElementById('result-title');
            const cupContainer = document.getElementById('cup-container');

            // Äiá»u kiá»‡n 3/5 cÃ¢u = 60%
            if (percentage >= 60) { 
                titleEl.textContent = "Xuáº¥t sáº¯c!";
                cupContainer.style.display = 'block';
                triggerFireworks();
                
                normalResultContent.classList.add('hidden');
                robotMessageContent.classList.remove('hidden');
                robotCongratsEl.textContent = `UKA Háº¡ Long chÃºc má»«ng ${studentInfo.name} Ä‘Ã£ vÆ°á»£t qua thá»­ thÃ¡ch vÃ  Ä‘áº¡t Ä‘Æ°á»£c huy hiá»‡u tuáº§n â€œChiáº¿n binh an toÃ n sá»‘â€!`;
            } else {
                titleEl.textContent = "Cá»‘ gáº¯ng hÆ¡n nhÃ©!";
                messageEl.textContent = `HÃ£y Ã´n láº¡i kiáº¿n thá»©c vÃ  thá»­ láº¡i nhÃ©, ${studentInfo.name}!`;
                cupContainer.style.display = 'none';
                normalResultContent.classList.remove('hidden');
                robotMessageContent.classList.add('hidden');
            }
        }

        function triggerFireworks() {
            const duration = 4 * 1000; // Run for 4 seconds
            const animationEnd = Date.now() + duration;
            const myConfetti = confetti.create(fireworksCanvas, {
                resize: true,
                useWorker: true
            });

            const colors = ['#00529D', '#FFD700', '#FFFFFF', '#4169E1', '#FF6347', '#32CD32'];

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);
                
                myConfetti({
                    startVelocity: 30, spread: 360, ticks: 60, zIndex: 100, particleCount,
                    origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }, colors: colors
                });
                myConfetti({
                    startVelocity: 30, spread: 360, ticks: 60, zIndex: 100, particleCount,
                    origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }, colors: colors
                });
            }, 250);
        }
        
        async function saveDataToGoogleSheets(week, score) {
             const scriptURL = 'https://script.google.com/macros/s/AKfycbx7ncf7mNXbsFJFbh_p8bU-AdBC8VYiFROj5cZfS8BLMF6Se2Ksp0zcF_Qj4UaTzgXApQ/exec'; // Link tháº§y Ä‘Ã£ cung cáº¥p
            const formData = new FormData();
            formData.append('Hoten', studentInfo.name);
            formData.append('Email', studentInfo.email);
            formData.append('Lop', studentInfo.class);
            formData.append('Tuan', week); // Gá»­i mÃ£ tuáº§n ('week4')
            formData.append('Diemso', score);
            try {
                 await fetch(scriptURL, { method: 'POST', body: formData });
            } catch (error) {
                console.error('Lá»—i khi gá»­i dá»¯ liá»‡u:', error.message);
            }
        }
        
        function resetApp() {
            resultModal.classList.add('hidden');
            quizContainer.classList.remove('submitted');
            submitQuizBtn.disabled = false;
            normalResultContent.classList.remove('hidden');
            robotMessageContent.classList.add('hidden');
            showView(registrationView);
        }

        function retryFromTheory() {
            resultModal.classList.add('hidden');
            quizContainer.classList.remove('submitted');
            submitQuizBtn.disabled = false;
            // LuÃ´n quay láº¡i 'week1' vÃ¬ Ä‘Ã³ lÃ  key duy nháº¥t chá»©a ná»™i dung
            showTheory('week1'); 
        }

        // --- EVENT LISTENERS ---
        registrationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            studentInfo.name = document.getElementById('student-name').value;
            studentInfo.email = document.getElementById('student-email').value;
            studentInfo.class = document.getElementById('student-class').value;
            if (!studentInfo.name || !studentInfo.email || !studentInfo.class) {
                alert('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin.');
                return;
            }
            // LuÃ´n hiá»ƒn thá»‹ ná»™i dung cá»§a 'week1' vÃ¬ Ä‘Ã£ gá»™p
            showTheory('week1'); 
        });

        startQuizBtn.addEventListener('click', () => {
            showView(quizView);
            displayQuiz();
        });

        submitQuizBtn.addEventListener('click', submitQuiz);
        closeModalBtn.addEventListener('click', resetApp);
        continueBtn.addEventListener('click', resetApp);
        continueBtnFail.addEventListener('click', retryFromTheory);

        const shareOnFacebook = () => {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(`"${studentInfo.name}" Ä‘Ã£ Ä‘áº¡t danh hiá»‡u "Chiáº¿n binh an toÃ n sá»‘" trong chiáº¿n dá»‹ch KhÃ´ng Má»™t MÃ¬nh!`);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
        };
        
        const shareOnZalo = () => {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://zalo.me/share/link?url=${url}`, '_blank');
        };
        
        document.querySelectorAll('#share-fb-2').forEach(btn => btn.addEventListener('click', shareOnFacebook));
        document.querySelectorAll('#share-zalo-2').forEach(btn => btn.addEventListener('click', shareOnZalo));

    </script>
</body>
</html>
